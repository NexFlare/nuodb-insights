{"meta":{"type":"db","canSave":true,"canEdit":true,"canAdmin":true,"canStar":true,"canDelete":true,"slug":"sql-log","url":"/d/f91c18e0-f71c-46eb-a3a8-2d0f63407d5b/sql-log","expires":"0001-01-01T00:00:00Z","created":"2023-07-28T13:06:30Z","updated":"2023-07-28T17:02:33Z","updatedBy":"admin","createdBy":"admin","version":8,"hasAcl":false,"isFolder":false,"folderId":20,"folderUid":"b7c2a563-48a3-426d-be2b-0f9fffbd8a85","folderTitle":"nuodb_client","folderUrl":"/dashboards/f/b7c2a563-48a3-426d-be2b-0f9fffbd8a85/nuodb-client","provisioned":false,"provisionedExternalId":"","annotationsPermissions":{"dashboard":{"canAdd":true,"canEdit":true,"canDelete":true},"organization":{"canAdd":true,"canEdit":true,"canDelete":true}},"publicDashboardAccessToken":"","publicDashboardUid":"","publicDashboardEnabled":false},"dashboard":{"annotations":{"list":[{"builtIn":1,"datasource":{"type":"grafana","uid":"-- Grafana --"},"enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations \u0026 Alerts","type":"dashboard"}]},"editable":true,"fiscalYearStartMonth":0,"graphTooltip":0,"id":31,"links":[],"liveNow":false,"panels":[{"datasource":{"type":"loki","uid":"ddd2f51e-f7a2-4b0b-82fb-2c6385f3f6d3"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"hideFrom":{"legend":false,"tooltip":false,"viz":false}},"links":[{"title":"","url":"d/f91c18e0-f71c-46eb-a3a8-2d0f63407d5b/sql-log?${__all_variables}\u0026${__url_time_range}\u0026var-xplan=${__data.fields[\"Explain Plan\"]}"}],"mappings":[]},"overrides":[{"__systemRef":"hideSeriesFrom","matcher":{"id":"byNames","options":{"mode":"exclude","names":["Value #A","4571773242669381676","5576481376483995567","0"],"prefix":"All except:","readOnly":true}},"properties":[{"id":"custom.hideFrom","value":{"legend":false,"tooltip":false,"viz":true}}]}]},"gridPos":{"h":8,"w":6,"x":0,"y":0},"id":3,"links":[{"title":"","url":"d/f91c18e0-f71c-46eb-a3a8-2d0f63407d5b/sql-log?${${__all_variables}\u0026${__url_time_range}"}],"options":{"legend":{"displayMode":"list","placement":"right","showLegend":true},"pieType":"pie","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":true},"tooltip":{"mode":"single","sort":"none"}},"pluginVersion":"10.0.3","targets":[{"datasource":{"type":"loki","uid":"ddd2f51e-f7a2-4b0b-82fb-2c6385f3f6d3"},"editorMode":"builder","expr":"sum by(xplanhash) (count_over_time({job=\"execution\", stmthash=~\"$statement\"} |~ `$filter` |= `$xplan` | logfmt [$__range]))","key":"Q-750d1062-cf8f-4219-b251-cca241a74556-0","legendFormat":"","queryType":"instant","refId":"A"}],"title":"Explain Plan Distribution","transformations":[{"id":"organize","options":{"excludeByName":{"Time":true,"Value #A":false},"indexByName":{},"renameByName":{"Value #A":"","xplanhash":"Explain Plan"}}}],"type":"piechart"},{"datasource":{"type":"loki","uid":"ddd2f51e-f7a2-4b0b-82fb-2c6385f3f6d3"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"hideFrom":{"legend":false,"tooltip":false,"viz":false}},"mappings":[]},"overrides":[{"__systemRef":"hideSeriesFrom","matcher":{"id":"byNames","options":{"mode":"exclude","names":["Value #A"],"prefix":"All except:","readOnly":true}},"properties":[{"id":"custom.hideFrom","value":{"legend":false,"tooltip":false,"viz":true}}]}]},"gridPos":{"h":8,"w":6,"x":6,"y":0},"id":4,"options":{"legend":{"displayMode":"list","placement":"right","showLegend":true},"pieType":"pie","reduceOptions":{"calcs":["lastNotNull"],"fields":"","limit":10,"values":true},"tooltip":{"mode":"single","sort":"none"}},"pluginVersion":"10.0.3","targets":[{"datasource":{"type":"loki","uid":"ddd2f51e-f7a2-4b0b-82fb-2c6385f3f6d3"},"editorMode":"builder","expr":"sum by(stmthash) (count_over_time({job=\"execution\", stmthash=~\"$statement\"} |~ `$filter` |= `$xplan` [$__range]))","key":"Q-750d1062-cf8f-4219-b251-cca241a74556-0","legendFormat":"","queryType":"instant","refId":"A"}],"title":"Statements","transformations":[{"id":"organize","options":{"excludeByName":{"Time":true,"Value #A":false},"indexByName":{},"renameByName":{"Value #A":"","xplanhash":"Explain Plan"}}}],"type":"piechart"},{"datasource":{"type":"loki","uid":"ddd2f51e-f7a2-4b0b-82fb-2c6385f3f6d3"},"description":"Note the calculation is down in browser and the query is limited to 5000 lines returned from loki.","fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"hideFrom":{"legend":false,"tooltip":false,"viz":false}},"links":[{"title":"Statement Filter","url":"/d/f91c18e0-f71c-46eb-a3a8-2d0f63407d5b/sql-log?var-statement=${__data.fields.stmthash}\u0026${filter:queryparam}\u0026${filters:queryparam}\u0026${__url_time_range}"}],"mappings":[],"unit":"Âµs"},"overrides":[{"matcher":{"id":"byName","options":"stmthash"},"properties":[{"id":"unit","value":"string"}]}]},"gridPos":{"h":8,"w":6,"x":12,"y":0},"id":5,"options":{"legend":{"displayMode":"table","placement":"right","showLegend":true},"pieType":"pie","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":true},"tooltip":{"mode":"single","sort":"none"}},"pluginVersion":"10.0.3","targets":[{"datasource":{"type":"loki","uid":"ddd2f51e-f7a2-4b0b-82fb-2c6385f3f6d3"},"editorMode":"builder","expr":"{job=\"execution\", stmthash=~\"$statement\"} |~ `$filter` |= `$xplan` | logfmt","maxLines":5000,"queryType":"range","refId":"A","resolution":1}],"title":"Top 10 ExecTime for first 5000 execution in time window","transformations":[{"id":"extractFields","options":{"format":"auto","keepTime":true,"replace":true,"source":"labels"}},{"id":"organize","options":{"excludeByName":{"Time":true,"compiletime":true,"connid":true,"ddlop":true,"deletions":true,"diskspill":true,"dmlop":true,"evicted":true,"execcount":true,"filename":true,"hostname":true,"indexfetches":true,"indexhits":true,"inserts":true,"job":true,"locked":true,"numindexfetch":true,"numtablefetch":true,"peakmemusage":true,"recordsfetched":true,"recordsreturned":true,"rejectindexhits":true,"replaces":true,"sorted":true,"sqlhash":true,"tablefetches":true,"time":true,"transid":true,"updates":true,"xplanhash":true},"indexByName":{},"renameByName":{}}},{"id":"convertFieldType","options":{"conversions":[{"destinationType":"number","targetField":"exectime"}],"fields":{}}},{"id":"groupBy","options":{"fields":{"exectime":{"aggregations":["sum"],"operation":"aggregate"},"stmthash":{"aggregations":[],"operation":"groupby"}}}}],"type":"piechart"},{"datasource":{"type":"loki","uid":"ddd2f51e-f7a2-4b0b-82fb-2c6385f3f6d3"},"gridPos":{"h":19,"w":24,"x":0,"y":8},"id":2,"options":{"dedupStrategy":"none","enableLogDetails":true,"prettifyLogMessage":false,"showCommonLabels":false,"showLabels":false,"showTime":true,"sortOrder":"Descending","wrapLogMessage":false},"targets":[{"datasource":{"type":"loki","uid":"ddd2f51e-f7a2-4b0b-82fb-2c6385f3f6d3"},"editorMode":"builder","expr":"{job=\"execution\", stmthash=~\"$statement\"} |~ `$filter` |= `$xplan` | logfmt","key":"Q-750d1062-cf8f-4219-b251-cca241a74556-0","queryType":"range","refId":"A"}],"title":"New Panel","transformations":[{"id":"extractFields","options":{"format":"auto","keepTime":false,"replace":false,"source":"labels"}},{"id":"organize","options":{"excludeByName":{"Line":false,"compiletime":true,"connid":true,"ddlop":true,"deletions":true,"diskspill":true,"dmlop":true,"evicted":true,"execcount":true,"filename":true,"hostname":true,"id":true,"indexfetches":true,"indexhits":true,"inserts":true,"job":true,"labels":false,"locked":true,"numindexfetch":true,"numtablefetch":true,"peakmemusage":true,"recordsfetched":true,"recordsreturned":true,"rejectindexhits":true,"replaces":true,"sorted":true,"sqlhash":true,"stmthash":true,"tablefetches":true,"time":true,"transid":true,"tsNs":true,"updates":true,"xplanhash":true},"indexByName":{"Line":0,"Time":1,"compiletime":6,"connid":7,"ddlop":8,"deletions":9,"diskspill":10,"dmlop":11,"evicted":12,"execcount":13,"exectime":2,"filename":14,"hostname":15,"id":5,"indexfetches":16,"indexhits":17,"inserts":18,"job":19,"labels":3,"locked":20,"numindexfetch":21,"numtablefetch":22,"peakmemusage":23,"recordsfetched":24,"recordsreturned":25,"rejectindexhits":26,"replaces":27,"sorted":28,"sqlhash":29,"stmthash":30,"tablefetches":31,"time":32,"transid":33,"tsNs":4,"updates":34,"xplanhash":35},"renameByName":{}}}],"type":"logs"}],"refresh":false,"schemaVersion":38,"style":"dark","tags":[],"templating":{"list":[{"current":{"selected":true,"text":["All"],"value":["$__all"]},"datasource":{"type":"loki","uid":"ddd2f51e-f7a2-4b0b-82fb-2c6385f3f6d3"},"definition":"","hide":0,"includeAll":true,"label":"statement","multi":true,"name":"statement","options":[],"query":{"label":"stmthash","refId":"LokiVariableQueryEditor-VariableQuery","stream":"","type":1},"refresh":1,"regex":"","skipUrlSync":false,"sort":0,"type":"query"},{"current":{"selected":false,"text":"xplanhash=0","value":"xplanhash=0"},"hide":0,"name":"filter","options":[{"selected":false,"text":"xplanhash=0","value":"xplanhash=0"}],"query":"xplanhash=0","skipUrlSync":false,"type":"textbox"},{"datasource":{"type":"loki","uid":"ddd2f51e-f7a2-4b0b-82fb-2c6385f3f6d3"},"filters":[{"condition":"","key":"xplanhash","operator":"!=","value":"0"}],"hide":0,"name":"filters","skipUrlSync":false,"type":"adhoc"},{"current":{"selected":false,"text":"xplanhash=","value":"xplanhash="},"hide":0,"label":"explainplan","name":"xplan","options":[{"selected":false,"text":"107543700268292789","value":"107543700268292789"}],"query":"107543700268292789","skipUrlSync":false,"type":"textbox"}]},"time":{"from":"2023-07-27T20:17:00.000Z","to":"2023-07-27T20:27:00.000Z"},"timepicker":{},"timezone":"","title":"SQL Log","uid":"f91c18e0-f71c-46eb-a3a8-2d0f63407d5b","version":8,"weekStart":""}}