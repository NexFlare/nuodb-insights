{"meta":{"type":"db","canSave":true,"canEdit":true,"canAdmin":true,"canStar":true,"canDelete":true,"slug":"sql-log","url":"/d/f91c18e0-f71c-46eb-a3a8-2d0f63407d5b/sql-log","expires":"0001-01-01T00:00:00Z","created":"2023-07-28T13:06:30Z","updated":"2023-07-29T00:53:29Z","updatedBy":"admin","createdBy":"admin","version":13,"hasAcl":false,"isFolder":false,"folderId":20,"folderUid":"b7c2a563-48a3-426d-be2b-0f9fffbd8a85","folderTitle":"nuodb_client","folderUrl":"/dashboards/f/b7c2a563-48a3-426d-be2b-0f9fffbd8a85/nuodb-client","provisioned":false,"provisionedExternalId":"","annotationsPermissions":{"dashboard":{"canAdd":true,"canEdit":true,"canDelete":true},"organization":{"canAdd":true,"canEdit":true,"canDelete":true}},"publicDashboardAccessToken":"","publicDashboardUid":"","publicDashboardEnabled":false},"dashboard":{"annotations":{"list":[{"builtIn":1,"datasource":{"type":"grafana","uid":"-- Grafana --"},"enable":true,"hide":true,"iconColor":"rgba(0, 211, 255, 1)","name":"Annotations \u0026 Alerts","type":"dashboard"}]},"editable":true,"fiscalYearStartMonth":0,"graphTooltip":0,"id":31,"links":[],"liveNow":false,"panels":[{"datasource":{"type":"marcusolsson-json-datasource","uid":"e2d5f30c-bad3-4d03-85c8-6185099c31e9"},"fieldConfig":{"defaults":{"color":{"mode":"thresholds"},"custom":{"align":"auto","cellOptions":{"type":"auto"},"inspect":false},"mappings":[],"thresholds":{"mode":"absolute","steps":[{"color":"green","value":null},{"color":"red","value":80}]}},"overrides":[{"matcher":{"id":"byName","options":"statement"},"properties":[{"id":"custom.hidden","value":true}]},{"matcher":{"id":"byName","options":"sql"},"properties":[{"id":"displayName","value":"Sql Statement"},{"id":"custom.inspect","value":true},{"id":"custom.filterable","value":true},{"id":"links","value":[{"title":"","url":"/d/f91c18e0-f71c-46eb-a3a8-2d0f63407d5b/sql-log?${__url_time_range}﻿﻿﻿﻿﻿\u0026var-statement=﻿﻿﻿${__data.fields.statement}﻿﻿﻿\u0026﻿﻿${explainplan:queryparam}﻿﻿\u0026﻿﻿${filters:queryparam}﻿﻿\u0026﻿﻿${search:queryparam﻿}\u0026${__url_time_range}"}]}]}]},"gridPos":{"h":9,"w":7,"x":0,"y":0},"id":6,"options":{"cellHeight":"sm","footer":{"countRows":false,"fields":"","reducer":["sum"],"show":false},"showHeader":true},"pluginVersion":"10.0.3","targets":[{"body":"select sqlstring,ID from system.localstatementcache","cacheDurationSeconds":0,"datasource":{"type":"marcusolsson-json-datasource","uid":"e2d5f30c-bad3-4d03-85c8-6185099c31e9"},"fields":[{"jsonPath":"$.data[*].sql","language":"jsonpath"},{"jsonPath":"$.data[*].statement","language":"jsonpath","name":""}],"key":"Q-899a8fb3-34f3-4994-bc57-fde9edf098a0-0","method":"GET","params":[["dbname","$database"]],"queryParams":"","refId":"A","urlPath":"/query"}],"title":"New Panel","type":"table"},{"datasource":{"type":"loki","uid":"ddd2f51e-f7a2-4b0b-82fb-2c6385f3f6d3"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"hideFrom":{"legend":false,"tooltip":false,"viz":false}},"mappings":[]},"overrides":[]},"gridPos":{"h":9,"w":5,"x":7,"y":0},"id":7,"options":{"legend":{"displayMode":"table","placement":"right","showLegend":true},"pieType":"pie","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":true},"tooltip":{"mode":"single","sort":"none"}},"pluginVersion":"10.0.3","targets":[{"datasource":{"type":"loki","uid":"ddd2f51e-f7a2-4b0b-82fb-2c6385f3f6d3"},"editorMode":"builder","expr":"sum by(statement) (count_over_time({source=\"executions\", explainplan=~\"$explainplan\", statement=~\"$statement\"} [$__range]))","key":"Q-00d75461-1f95-45bf-8a91-a7f263c61fdf-0","queryType":"instant","refId":"B"}],"title":"Statement Distribution","type":"piechart"},{"datasource":{"type":"loki","uid":"ddd2f51e-f7a2-4b0b-82fb-2c6385f3f6d3"},"fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"hideFrom":{"legend":false,"tooltip":false,"viz":false}},"links":[{"title":"","url":"/d/f91c18e0-f71c-46eb-a3a8-2d0f63407d5b/sql-log?${__url_time_range}﻿﻿﻿﻿﻿\u0026var-explainplan=﻿﻿﻿${__data.fields.explainplan}﻿﻿﻿\u0026﻿﻿${statement:queryparam}\u0026﻿﻿${filters:queryparam}﻿﻿\u0026﻿﻿${search:queryparam﻿}\u0026${__url_time_range}"}],"mappings":[]},"overrides":[]},"gridPos":{"h":9,"w":5,"x":12,"y":0},"id":8,"options":{"legend":{"displayMode":"table","placement":"right","showLegend":true},"pieType":"pie","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":true},"tooltip":{"mode":"single","sort":"none"}},"pluginVersion":"10.0.3","targets":[{"datasource":{"type":"loki","uid":"ddd2f51e-f7a2-4b0b-82fb-2c6385f3f6d3"},"editorMode":"builder","expr":"topk by(explainplan) (20, sum by(explainplan) (count_over_time({source=\"executions\", explainplan=~\"$explainplan\", statement=\"$statement\"} [$__range])))","key":"Q-00d75461-1f95-45bf-8a91-a7f263c61fdf-0","queryType":"instant","refId":"B"}],"title":"Explain Plan Distribution","type":"piechart"},{"datasource":{"type":"loki","uid":"ddd2f51e-f7a2-4b0b-82fb-2c6385f3f6d3"},"description":"Note the calculation is down in browser and the query is limited to 5000 lines returned from loki.","fieldConfig":{"defaults":{"color":{"mode":"palette-classic"},"custom":{"hideFrom":{"legend":false,"tooltip":false,"viz":false}},"links":[{"title":"Statement Filter","url":"/d/f91c18e0-f71c-46eb-a3a8-2d0f63407d5b/sql-log?var-statement=${__data.fields.stmthash}\u0026${filter:queryparam}\u0026${filters:queryparam}\u0026${__url_time_range}"}],"mappings":[],"unit":"µs"},"overrides":[{"matcher":{"id":"byName","options":"stmthash"},"properties":[{"id":"unit","value":"string"}]}]},"gridPos":{"h":8,"w":6,"x":18,"y":0},"id":5,"options":{"legend":{"displayMode":"table","placement":"right","showLegend":true},"pieType":"pie","reduceOptions":{"calcs":["lastNotNull"],"fields":"","values":true},"tooltip":{"mode":"single","sort":"none"}},"pluginVersion":"10.0.3","targets":[{"datasource":{"type":"loki","uid":"ddd2f51e-f7a2-4b0b-82fb-2c6385f3f6d3"},"editorMode":"builder","expr":"{job=\"execution\", stmthash=~\"$statement\"} |~ `$filter` |= `$xplan` | logfmt","maxLines":5000,"queryType":"range","refId":"A","resolution":1}],"title":"Top 10 ExecTime for first 5000 execution in time window","transformations":[{"id":"extractFields","options":{"format":"auto","keepTime":true,"replace":true,"source":"labels"}},{"id":"organize","options":{"excludeByName":{"Time":true,"compiletime":true,"connid":true,"ddlop":true,"deletions":true,"diskspill":true,"dmlop":true,"evicted":true,"execcount":true,"filename":true,"hostname":true,"indexfetches":true,"indexhits":true,"inserts":true,"job":true,"locked":true,"numindexfetch":true,"numtablefetch":true,"peakmemusage":true,"recordsfetched":true,"recordsreturned":true,"rejectindexhits":true,"replaces":true,"sorted":true,"sqlhash":true,"tablefetches":true,"time":true,"transid":true,"updates":true,"xplanhash":true},"indexByName":{},"renameByName":{}}},{"id":"convertFieldType","options":{"conversions":[{"destinationType":"number","targetField":"exectime"}],"fields":{}}},{"id":"groupBy","options":{"fields":{"exectime":{"aggregations":["sum"],"operation":"aggregate"},"stmthash":{"aggregations":[],"operation":"groupby"}}}}],"type":"piechart"},{"datasource":{"type":"loki","uid":"ddd2f51e-f7a2-4b0b-82fb-2c6385f3f6d3"},"gridPos":{"h":19,"w":24,"x":0,"y":9},"id":2,"options":{"dedupStrategy":"none","enableLogDetails":true,"prettifyLogMessage":false,"showCommonLabels":false,"showLabels":false,"showTime":true,"sortOrder":"Descending","wrapLogMessage":false},"targets":[{"datasource":{"type":"loki","uid":"ddd2f51e-f7a2-4b0b-82fb-2c6385f3f6d3"},"editorMode":"builder","expr":"{job=\"execution\", stmthash=~\"$statement\"} |~ `$filter` |= `$xplan` | logfmt","key":"Q-750d1062-cf8f-4219-b251-cca241a74556-0","queryType":"range","refId":"A"}],"title":"New Panel","transformations":[{"id":"extractFields","options":{"format":"auto","keepTime":false,"replace":false,"source":"labels"}},{"id":"organize","options":{"excludeByName":{"Line":false,"compiletime":true,"connid":true,"ddlop":true,"deletions":true,"diskspill":true,"dmlop":true,"evicted":true,"execcount":true,"filename":true,"hostname":true,"id":true,"indexfetches":true,"indexhits":true,"inserts":true,"job":true,"labels":false,"locked":true,"numindexfetch":true,"numtablefetch":true,"peakmemusage":true,"recordsfetched":true,"recordsreturned":true,"rejectindexhits":true,"replaces":true,"sorted":true,"sqlhash":true,"stmthash":true,"tablefetches":true,"time":true,"transid":true,"tsNs":true,"updates":true,"xplanhash":true},"indexByName":{"Line":0,"Time":1,"compiletime":6,"connid":7,"ddlop":8,"deletions":9,"diskspill":10,"dmlop":11,"evicted":12,"execcount":13,"exectime":2,"filename":14,"hostname":15,"id":5,"indexfetches":16,"indexhits":17,"inserts":18,"job":19,"labels":3,"locked":20,"numindexfetch":21,"numtablefetch":22,"peakmemusage":23,"recordsfetched":24,"recordsreturned":25,"rejectindexhits":26,"replaces":27,"sorted":28,"sqlhash":29,"stmthash":30,"tablefetches":31,"time":32,"transid":33,"tsNs":4,"updates":34,"xplanhash":35},"renameByName":{}}}],"type":"logs"}],"refresh":"","schemaVersion":38,"style":"dark","tags":[],"templating":{"list":[{"current":{"selected":false,"text":".+","value":".+"},"hide":0,"label":"statement","name":"statement","options":[{"selected":false,"text":".+","value":".+"}],"query":".+","skipUrlSync":false,"type":"textbox"},{"current":{"selected":false,"text":".+","value":".+"},"hide":0,"label":"explainplan","name":"explainplan","options":[{"selected":true,"text":".+","value":".+"}],"query":".+","skipUrlSync":false,"type":"textbox"},{"current":{"selected":false,"text":"","value":""},"hide":0,"label":"search","name":"search","options":[{"selected":true,"text":"","value":""}],"query":"","skipUrlSync":false,"type":"textbox"},{"datasource":{"type":"loki","uid":"ddd2f51e-f7a2-4b0b-82fb-2c6385f3f6d3"},"filters":[{"condition":"","key":"xplanhash","operator":"!=","value":"0"}],"hide":0,"name":"filters","skipUrlSync":false,"type":"adhoc"}]},"time":{"from":"2023-07-27T20:17:00.000Z","to":"2023-07-27T20:27:00.000Z"},"timepicker":{},"timezone":"","title":"SQL Log","uid":"f91c18e0-f71c-46eb-a3a8-2d0f63407d5b","version":13,"weekStart":""}}